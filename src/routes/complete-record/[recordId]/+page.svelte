<script lang="ts">
    import { goto } from "$app/navigation";
    import { page } from "$app/stores";
    import { getMealRecordById, getMealTypeById, getRestaurantById, updateMealRecord } from "$ts/functions";
    import type { MealRecord, MealType, Restaurant } from "$ts/interfaces";
    import { onMount } from "svelte";

    const recordId = $page.params.recordId

    let record: MealRecord;
    let mealType: MealType;
    let restaurant: Restaurant;

    let resultValue: string;

    function save() {
      updateMealRecord(recordId, parseInt(resultValue))

      goto('/stats')
    }

  onMount(() => {
    record = getMealRecordById(recordId)
    mealType = getMealTypeById(record?.mealTypeId)
    restaurant = getRestaurantById(mealType?.restaurantId)

    if (record.result) {
      resultValue = record.result;
    }

    console.log(record)
    console.log(mealType)
    console.log(restaurant)
  })
</script>

<div class="border-b py-4 flex items-center px-4">
  <div class="flex-grow">
    <div class="text-lg font-bold">Místo</div>
    <div class="text-lg">{restaurant?.name || 'N/A'}</div>
  </div>

  <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M15 10.5C15 11.2956 14.6839 12.0587 14.1213 12.6213C13.5587 13.1839 12.7956 13.5 12 13.5C11.2044 13.5 10.4413 13.1839 9.87868 12.6213C9.31607 12.0587 9 11.2956 9 10.5C9 9.70435 9.31607 8.94129 9.87868 8.37868C10.4413 7.81607 11.2044 7.5 12 7.5C12.7956 7.5 13.5587 7.81607 14.1213 8.37868C14.6839 8.94129 15 9.70435 15 10.5Z" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M19.5 10.5C19.5 17.642 12 21.75 12 21.75C12 21.75 4.5 17.642 4.5 10.5C4.5 8.51088 5.29018 6.60322 6.6967 5.1967C8.10322 3.79018 10.0109 3 12 3C13.9891 3 15.8968 3.79018 17.3033 5.1967C18.7098 6.60322 19.5 8.51088 19.5 10.5Z" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>    
</div>

<div class="border-b py-4 flex items-center px-4">
  <div class="flex-grow">
    <div class="text-lg font-bold">Jídlo</div>
    <div class="text-lg">{mealType?.name || 'N/A'}</div>
  </div>

  <svg width="32" height="32" viewBox="0 0 27 27" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M24.8581 21.2549C24.9012 21.152 24.9012 21.0355 24.8581 20.9326C24.8151 20.8292 24.7333 20.7474 24.6299 20.7044C24.5784 20.6828 24.5236 20.6719 24.4688 20.6719H23.4141C23.4136 15.3373 19.2004 10.989 13.9198 10.7684C13.9198 10.7646 13.9219 10.7612 13.9219 10.7578V9.63436C14.5302 9.45169 14.9761 8.89481 14.9766 8.22656C14.9761 7.41066 14.3159 6.75042 13.5 6.75C12.6841 6.75042 12.0239 7.41066 12.0234 8.22656C12.0239 8.89481 12.4698 9.45169 13.0781 9.63436V10.7578C13.0781 10.7616 13.0802 10.765 13.0802 10.7684C7.79963 10.989 3.58636 15.3373 3.58594 20.6719H2.53125C2.47641 20.6719 2.42157 20.6828 2.3701 20.7044C2.26674 20.7474 2.18489 20.8292 2.14186 20.9326C2.09883 21.0355 2.09883 21.152 2.14186 21.2549C2.16338 21.3068 2.19417 21.3536 2.23341 21.3924L4.71319 23.8722C5.01694 24.1739 5.42152 24.4152 5.85352 24.5957C6.28678 24.7738 6.74367 24.8889 7.17188 24.8906H19.8281C20.2563 24.8889 20.7132 24.7738 21.1465 24.5957C21.5785 24.4152 21.9831 24.1739 22.2868 23.8722L24.7666 21.3924C24.8058 21.3536 24.8366 21.3068 24.8581 21.2549ZM12.8672 8.22656C12.868 7.87725 13.1507 7.59459 13.5 7.59375C13.8493 7.59459 14.132 7.87725 14.1328 8.22656C14.132 8.57588 13.8493 8.85853 13.5 8.85938C13.1507 8.85853 12.868 8.57588 12.8672 8.22656ZM7.08666 14.2585C8.72902 12.6162 10.9945 11.6016 13.5 11.6016C16.0055 11.6016 18.271 12.6162 19.9133 14.2585C21.5557 15.9009 22.5699 18.1664 22.5703 20.6719H4.42969C4.42969 18.1664 5.4443 15.9009 7.08666 14.2585ZM21.6903 23.2757C21.5021 23.466 21.1743 23.6718 20.8233 23.8161C20.4736 23.9625 20.0964 24.0486 19.8281 24.0469H7.17188C6.90357 24.0486 6.52641 23.9625 6.17667 23.8161C5.82567 23.6718 5.4983 23.466 5.30972 23.2757L3.54966 21.5156H23.4503L21.6903 23.2757Z" fill="#231F20" stroke="black" stroke-width="0.32"/>
    <path d="M10.4136 13.5219C9.05977 13.9725 8.15063 14.7664 7.58616 15.4448C7.02084 16.124 6.79219 16.6893 6.78038 16.7189C6.69389 16.9353 6.79936 17.1808 7.01578 17.2673C7.2322 17.3538 7.47774 17.2483 7.56422 17.0319V17.0311C7.57772 16.9982 7.7895 16.5033 8.28141 15.9295C8.77416 15.3554 9.53986 14.7027 10.681 14.3218C10.9017 14.2484 11.0215 14.0096 10.9477 13.7881C10.8734 13.5675 10.6346 13.4481 10.4136 13.5219Z" fill="#231F20" stroke="black" stroke-width="0.32"/>
    </svg>    
</div>

<div class="border-b py-4 flex items-center px-4">
  <div class="flex-grow">
    <div class="text-lg font-bold">Hladiny glokózy před jídlem</div>
    <div class="text-lg">{record?.init || 'N/A'}</div>
  </div>

  <svg width="28" height="28" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g clip-path="url(#clip0_3_640)">
    <path d="M3.00001 0C1.45833 0 0.200012 1.25832 0.200012 2.8C0.200012 4.34168 1.45833 5.6 3.00001 5.6C3.62721 5.6 4.20745 5.39168 4.67513 5.0408L8.18953 8.55536C7.69617 9.17152 7.40001 9.95192 7.40001 10.8C7.40001 11.7094 7.74049 12.5411 8.29969 13.1758L4.29425 17.5817C3.92025 17.3406 3.47593 17.2 3.00001 17.2C1.67929 17.2 0.600012 18.2793 0.600012 19.6C0.600012 20.9207 1.67929 22 3.00001 22C4.32073 22 5.40001 20.9207 5.40001 19.6C5.40001 19.0426 5.20729 18.5286 4.88577 18.1202L8.89137 13.7142C9.48473 14.145 10.2131 14.4 10.9999 14.4C12.3103 14.4 13.4602 13.6943 14.0899 12.6436L17.8512 14.3538C17.8181 14.4974 17.7999 14.6466 17.7999 14.8C17.7999 15.8998 18.7001 16.8 19.7999 16.8C20.8998 16.8 21.7999 15.8998 21.7999 14.8C21.7999 13.7002 20.8998 12.8 19.7999 12.8C19.1379 12.8 18.5486 13.1266 18.184 13.6262L14.4219 11.9156C14.537 11.564 14.6 11.1893 14.6 10.8C14.6 8.81648 12.9835 7.2 11 7.2C10.1519 7.2 9.37153 7.49616 8.75529 7.98952L5.24081 4.4752C5.59169 4.00744 5.80001 3.4272 5.80001 2.8C5.80001 1.25832 4.54169 0 3.00001 0ZM3.00001 0.8C4.10929 0.8 5.00001 1.69072 5.00001 2.8C5.00001 3.90928 4.10929 4.8 3.00001 4.8C1.89073 4.8 1.00001 3.90928 1.00001 2.8C1.00001 1.69072 1.89073 0.8 3.00001 0.8ZM11 8C12.5511 8 13.8 9.24888 13.8 10.8C13.8 12.3511 12.5511 13.6 11 13.6C9.44889 13.6 8.20001 12.3511 8.20001 10.8C8.20001 9.24888 9.44889 8 11 8ZM19.8 13.6C20.4675 13.6 21 14.1325 21 14.8C21 15.4674 20.4675 16 19.8 16C19.1325 16 18.6 15.4674 18.6 14.8C18.6 14.1325 19.1326 13.6 19.8 13.6ZM3.00001 18C3.88841 18 4.60001 18.7116 4.60001 19.6C4.60001 20.4884 3.88841 21.2 3.00001 21.2C2.11161 21.2 1.40001 20.4884 1.40001 19.6C1.40001 18.7116 2.11161 18 3.00001 18Z" fill="black"/>
    </g>
    <defs>
    <clipPath id="clip0_3_640">
    <rect width="22" height="22" fill="white"/>
    </clipPath>
    </defs>
    </svg>    
</div>

<div class="py-4 items-center px-4">
  <div class="text-lg font-bold">Hladina glukózy 2 hodiny po jídle</div>
</div>

<input type="number" class="text-7xl text-center mt-8" placeholder="--" bind:value={resultValue}>
<div class="text-center font-semibold text-lg text-gray-500">mmol/L</div>

<button class="font-semibold h-12 rounded-full border w-32 mx-auto mt-12 enabled:active:scale-90 duration-200 disabled:opacity-50" on:click={save} disabled={!resultValue}>Uložit</button>